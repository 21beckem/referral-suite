<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Referral Suite</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="script.js" dont-redirect="true"></script>
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="/referral-suite/manifest.webmanifest">
    <meta name="theme-color" content="#462c6a">
  </head>
  <body>
    <!-- Top Bar -->
    <div class="w3-top w3-cell-row w3-area-blue">
      <div class="w3-container w3-area-blue w3-cell w3-center w3-xlarge w3-padding-16 w3-text-white">
        <a>Choose your area</a>
      </div>
    </div>
    <div style="height: 35px;"></div>

    <!-- Login Buttons -->
    <div id="arealoginbuttons">
      <div style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);">
        <div class="lds-dual-ring"></div>
      </div>
    </div>
    <script>
setCookie('dataSync', null);
setCookie('areaUser', '');
setCookie('suSync', null);
setCookie('areaUserEmail', '');
function signInAsArea(el) {
  setCookie('areaUserEmail', el.getAttribute('email'));
  setCookie('areaUser', el.innerHTML);
  safeRedirect('force-sync.html');
}
function safeRedirect(ref) {
  if (!inIframe()) {
    window.location.href = ref;
    return;
  }
  window.parent.postMessage(JSON.stringify({
    type: 'redirect',
    data: ref,
  }), '*');
}
function inIframe() { try {return window.self !== window.top;} catch(e) {return true;} }
function setCookie(cname, cvalue) {
  localStorage.setItem(cname, cvalue);
}
// get inboxing areas
async function fillInAreaButtons() {
  const cfg = await SYNC_getConfig();
  const arealoginbuttons = _('arealoginbuttons');
  let output = '';
  for (const [area, email] of Object.entries(cfg.inboxers)) {
    output += '<button email="'+email[0]+'" onclick="signInAsArea(this)">'+area+'</button>'
  }
  arealoginbuttons.innerHTML = output;
}
fillInAreaButtons();
    </script>
  </body>
</html>
