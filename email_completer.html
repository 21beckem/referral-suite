<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Complete Email</title>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="styles.css">
        <script src="script.js"></script>
        <style>
#selectRefType {
    width: 100%;
    padding: 5px;
    border-radius: 3px;
}
#messageExamples {
    width: 100%;
    padding: 0px 10px;
}
.googleMessage {
    width: 100%;
    background-color: white;
    padding: 10px 15px;
    /* border-radius: 20px; */
}
.useThisTemplateBtn {
    padding: 5px 20px;
    border-radius: 3px;
    margin-top: 10px;
    border: 0;
    background-color: var(--email-color);
    color: white;
    width: max-content;
}
input[type="text"] {
  width: 100%;
}
.ljus {
	background-color: #ccf0ff;
}
.ljus.selected {
	background-color: #dfc9ff;
}
    </style>
  </head>
  <body>
    <!-- Top Bar -->
    <div class="w3-top">
        <div class="w3-cell-row w3-area-blue">
            <div class="w3-container w3-area-blue w3-cell w3-center w3-xlarge w3-padding-16 w3-text-white">
                <a>Complete Email</a>
            </div>
        </div>
    </div>
	<div style="height: 70px;"></div>
	<!-- Search bar -->
	<div id="completerItemsParent" class="w3-container w3-white w3-padding w3-card-subtle">
	</div>
    <div class="w3-panel w3-card-subtle w3-light-grey w3-padding-16">
		<div id="MessageOutput" class="googleMessage"></div>
		<button onclick="sendTheMessage()" class="useThisTemplateBtn">Send</button>
    </div>
	<a id="fakeLinkToClickToSend" href="" style="display: none;" target="_blank"></a>

    <script>
function _(x) { return document.getElementById(x); }

const templateMssg = `Hej {Name}!

This is your area: {Area}

Tack s√• mycket f√∂r att du svarade v√•r annons om en gratis Mormons bok: √Ñnnu ett Jesu Kristi testamente! Vi har f√∂rs√∂kt att kontakta dig f√∂r att bekr√§fta din adress! √Ñr det h√§r din adress? {insert address}

Mvh

Vandra i tro`;

const ThingsToComplete = templateMssg.match(/{[^}]*}/gm);
const MessageOutput = _('MessageOutput');

//make a formated message ready to edit
let newTmpMssg = templateMssg;
let inputsOutput = '';
for (let i = 0; i < ThingsToComplete.length; i++) {
	const el = ThingsToComplete[i];
	newTmpMssg = newTmpMssg.replace(el, '<span id="completerViewThing_'+String(el)+'" class="ljus">'+el+'</span>');
	elShort = el.substring(1, el.length - 1);
	inputsOutput += '<label for="' + elShort + '">' + elShort + ' </label><br><input autocomplete="false" oninput="updateField(this)" onfocus="focusThisFieldInMssg(this)" name="' + elShort + '" type="text"><br>';
}
newTmpMssg = newTmpMssg.replace(/(?:\r\n|\r|\n)/g, '<br>');
MessageOutput.innerHTML = newTmpMssg;
_('completerItemsParent').innerHTML = inputsOutput;

function focusThisFieldInMssg(el) {
	let allCompleters = MessageOutput.querySelectorAll('.ljus');
	for (let i = 0; i < allCompleters.length; i++) {
		const e = allCompleters[i];
		e.classList.remove('selected');
	}
	_('completerViewThing_{'+el.name+'}').classList.add('selected');
}

function updateField(el) {
	if (el.value == "") {
		_('completerViewThing_{'+el.name+'}').innerHTML = '{'+el.name+'}';
	} else {
		_('completerViewThing_{'+el.name+'}').innerHTML = el.value;
	}
}

function sendTheMessage() {
	const person = getCookieJSON('linkPages') || null;
    const emailLink = 'https://docs.google.com/forms/d/e/1FAIpQLSefh5bdklMCAE-XKvq-eg1g7elYIA0Fudk-ypqLaDm0nO1EXA/viewform?usp=pp_url&entry.925114183=' + person[9] + '&entry.873933093=' + getCookie('areaUserEmail') + '&entry.1947536680=' + encodeURI(MessageOutput.innerText);
	_('fakeLinkToClickToSend').href = emailLink;
  	let listOfIns = _('completerItemsParent').querySelectorAll('INPUT');
	let send = true;
	listOfIns.forEach(el => {
		if (el.value == "") {
			send = false;
		}
	});
	if (send) {
		_('fakeLinkToClickToSend').click();
	} else {
		alert('Please fill out the required info üôÉ');
	}
}





















    </script>

    <!-- Bottom Nav Bar -->
    <div style="height: 60px;"></div>
    <div class="w3-bottom w3-cell-row w3-light-gray w3-padding-16">

      <div class="w3-container w3-cell w3-center w3-xlarge">
        <a href="index.html">
          <i class="fa fa-home"></i>
          <div class="w3-tiny w3-opacity" style="height: 0;">Home</div>
        </a>
      </div>

      <div class="w3-container w3-cell w3-center w3-xlarge">
        <a href="schedule.html">
          <i class="fa fa-calendar-o"></i>
          <div class="w3-tiny w3-opacity" style="height: 0;">Schedule</div>
        </a>
      </div>

      <div class="w3-container w3-cell w3-center w3-xlarge w3-text-area-blue">
        <a href="contact_book.html">
          <i class="fa fa-address-book"></i>
          <div class="w3-tiny w3-opacity" style="height: 0;">Referrals</div>
        </a>
      </div>

      <div class="w3-container w3-cell w3-center w3-xlarge">
        <a href="unclaimed_referrals.html">
          <i class="fa fa-bell"></i>
          <div class="w3-tiny w3-opacity" style="height: 0;">Unclaimed</div>
        </a>
        <div style="height: 0; width: 100%;">
          <div id="reddot" class="w3-circle w3-red w3-notification-dot" style="display: none;"></div>
        </div>
      </div>

      <div class="w3-container w3-cell w3-center w3-xlarge">
        <a href="sync.html">
          <i class="fa fa-refresh"></i>
          <div class="w3-tiny w3-opacity" style="height: 0;">Sync</div>
        </a>
      </div>

    </div>

  </body>
</html>